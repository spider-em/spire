<html>
<head>
  <title>SPIRE - Tutorial</title>
  <LINK href="../style.css" type= text/css rel=stylesheet>
</head>

<body>
<table class="navi" cellpadding=8>
<tr>
<td>
Back: <a href="index.html">Tutorial</a></td>
<td align="center">
Home: <a href="../index.html">Table of Contents</a></td>
<td align="right">
Next: <a href="../project.html">Spire Projects</a></td>
</tr></table>

<p> 
<h2 align="center">Spire Tutorial - a second example</h2>
<p>
This project, defined by the configuration <code>simple2.xml</code>, has a larger set of batch files distributed in 3 subdirectories. A reference volume of a ribosome is supplied (reference_volume.dat). A test data set of noisy, ctf-modified particle images is generated from this volume using random angles and shifts. Then a set of reference images is generated from the same volume using equally spaced angles. The test images are then aligned with the reference images.
</p>

<ul>
<li> <code>cd</code> to a working directory, and run spire: <code><b>spire &</b></code></li>
<p></p>
<li>
In Spire's main window, under the <i>Project</i> menu, select <i>New</i>.</li>
<p></p>

<li>
Fill in the required fields in the Project window. Type in 'dat' as the data extension. For the Configuration file, select <code><b>simple2.xml</b></code>.<br>
When you hit 'OK', the project directory is created. The configuration specifies 3 subdirectories (<code>Align, Proj, Testdata</code>), as well as the batch files in each. (see the <code>&lt;Directories&gt;</code> tag in <code>simple2.xml</code>)</li>
<p></p>

<li>
In Spire's main window, under the <i>Dialogs</i> menu, you will see 3 dialogs: <i>Test data</i>, <i>Proj</i>, and <i>Align</i>. Note that the dialogs correspond to the project subdirectories, although this is not required. (You only need to run the "rename reference" batch file if you selected a data extension other than 'dat'.)</li>
<p></p>
<li>
Select the <i>Test data</i> dialog.</li>
<p></p>
<li>
Run the 4 batch files in SPIDER by clicking on their buttons. Or, you may click a batch file's EDIT button to view/change parameters. Note that if you change a batch files output, say <code>img001</code> to <code>img999</code>, then any other batch files expecting <code>img001</code> as input need to be edited to have the new value.
<p></p>
These batch files are run in the <code>Testdata</code> directory:
<table border=2 cellpadding=3>
<tr><td>randangles.spi</td> <td>make a doc file of random angles and shifts</td></tr>
<tr><td>makectfvol.spi</td> <td>make a CTF-multiplied volume for generating test images</td></tr>
<tr><td>gendata.spi</td> <td>generate projection images from the CTF-volume</td></tr>
<tr><td>addnoise.spi</td> <td>add noise to the randomly generated test images.</td></tr>
</table>
</li>
<p></p>

<li>
Close the <i>Test data</i> dialog.</li>
<p></p>
<hr>

<li>
Select the <i>Proj</i> dialog.</li>
<p></p>
<li>
Run the 3 batch files in this dialog; they are run in the <code>Proj</code> directory:
<table border=2 cellpadding=3>
<tr><td>mkrefangles.spi</td> <td>create a document file of equally-spaced reference angles</td></tr>
<tr><td>refproj.spi</td> <td>create projection images from the volume using the reference angles</td></tr>
</table>
<p></p>
While a SPIDER process is running, Spire displays a <a href="../run.html"><i>Spider process window</i></a>. This lets you monitor the state of the SPIDER process by displaying the last few lines of the results file (via the "check progress" button).
</li>
<p></p>

<li>
Close the <i>Proj</i> dialog.</li>
<p></p>
<hr>

<li>
Select the <i>Align</i> dialog.</li>
<p></p>
<li>
These batch files are run in the <code>Align</code> directory:
<table border=2 cellpadding=3>
<tr><td>apsh.spi</td> <td>align the shifted, rotated test image with the reference projections</td></tr>
<tr><td>align.spi</td> <td>apply the obtained alignment parameters to the image, creating an aligned image.</td></tr>
<tr><td>compare.spi</td> <td>compare the aligned images to their corresponding reference images.</td></tr>
</table>
<p></p>
</li>
<p></p>

<li>
Close the <i>Align</i> dialog.</li>
<p></p>
<hr>
<p></p>
<li>
<b>View the batch runs and data files for this project</b>. In the <i>Commands</i> menu, select <i>View project</i>. The project viewer will display. The upper pane of this window lists all the batch runs (successfully completed SPIDER jobs) of the project. Each batch run has a unique ID number.
<p></p>

<img src ="../pics/projview.gif">

<p></p>
The lower pane displays the output files for a selected batch run. Output files may be displayed  by clicking on them; images and volumes are displayed in Jweb, while documents are opened in a text editor. If Jweb doesn't automatically open from the Project viewer, try starting it by selecting <i>Commands</i> --> <i>Open Jweb</i>. Click on the last batch file, compare.spi. View the file montage.dat
</li>
<p></p>
<hr>
<p></p>
<li>
<b>Create a sequence for this project</b>. Sequences let you run multiple batch files. Under the <i>Sequences</i> menu, select <i>Create</i>. The Batch file sequence editor shows all of a project's batch files in the left window, files selected for the sequence appear in the right window. 
<p></p>

<img src ="../pics/sequence.gif">

<p></p>
<li>
Select all of the batch files on the left, add them to the right with the <b>&gt;&gt;</b> button. If the file <code>reference_volume.dat</code> appears on the right, you can't run that as a batch file - select it and click <i>Remove Batch</i>.</li>
<p></p>

<li>
Save the sequence: click the <i>Save Seq.</i> button, and save this sequence, giving it a name, e.g., <code>allfiles.seq</code>. Close the Sequence Editor window (<i>Done</i>).</li>
<p></p>

<li>
Run the sequence: under the <i>Sequences</i> menu, select <i>Run</i>. Select the sequence you just created. The batch files will be executed in the order specified by the sequence. If any batch file crashes (yes, this has happened to some people!), the sequence aborts at that point.</li>
<p></p>

<li>
If you open the project viewer, you will see that the sequence batch files have been added to the project.</li>
<p></p>
<hr>

<p></p>
<li>
<b>Save a description of the project in a set of web pages</b><br>
Under the <i>Project</i> menu, select <i>Save as html</i>. Give the top-level project web page a name, such as <code>proj001.html</code>, enter any notes pertaining to the project, and hit 'OK'.
<p></p>
Spire creates a main project html page, listing all the batch runs in this project. Each batch run has a link to a page showing the files created by that run.</li>



</ul>


<p>
<img src="../pics/spiderline.gif"><br>
<a href="index.html"><img src="../pics/left_button.gif"></a>
<a href="../index.html"><img src="../pics/up_button.gif"></a>
<a href="../project.html"><img src="../pics/right_button.gif"></a>
</p>

</body>
</html>
