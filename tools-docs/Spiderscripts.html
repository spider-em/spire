<html>
<head> <title>Spiderscripts.py</title></head>
<body bgcolor="#ffffff">
<pre><font face="Lucida,Courier New"><font color="#FF0000"># Spider Python Library: Spiderscript.py
</font><font color="#FF0000"># Copyright (C) 2006  Health Research Inc.
</font><font color="#FF0000">#
</font><font color="#FF0000"># HEALTH RESEARCH INCORPORATED (HRI),
</font><font color="#FF0000"># Menands, NY 12204
</font><font color="#FF0000">#
</font><font color="#FF0000"># Email:  spider@wadsworth.org
</font><font color="#FF0000">#
</font><font color="#FF0000"># This program is free software; you can redistribute it and/or
</font><font color="#FF0000"># modify it under the terms of the GNU General Public License as
</font><font color="#FF0000"># published by the Free Software Foundation; either version 2 of the
</font><font color="#FF0000"># License, or (at your option) any later version.
</font><font color="#FF0000">#
</font><font color="#FF0000"># This program is distributed in the hope that it will be useful,
</font><font color="#FF0000"># but WITHOUT ANY WARRANTY; without even the implied warranty of
</font><font color="#FF0000"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
</font><font color="#FF0000"># General Public License for more details.
</font><font color="#EB5E00">import</font> <font color="#000000">os</font><font color="#000000">,</font> <font color="#000000">sys</font>
<font color="#EB5E00">from</font> <font color="#000000">inspect</font> <font color="#EB5E00">import</font> <font color="#000000">currentframe</font><font color="#000000">,</font> <font color="#000000">getouterframes</font><font color="#000000">,</font> <font color="#000000">getframeinfo</font>
<font color="#EB5E00">from</font> <font color="#000000">linecache</font> <font color="#EB5E00">import</font> <font color="#000000">getline</font>
<font color="#EB5E00">import</font> <font color="#000000">re</font>

<font color="#EB5E00">from</font> <font color="#000000">Spiderutils</font> <font color="#EB5E00">import</font> <font color="#000000">fileReadLines</font><font color="#000000">,</font> <font color="#000000">makeSpiderFilename</font><font color="#000000">,</font> <font color="#000000">readdoc</font>

<font color="#FF0000">###################################################################
</font><font color="#FF0000">#
</font><font color="#FF0000"># Batch file utilities
</font>
<font color="#FF0000"># get data extension (3 letters with dot) from command line or user.
</font><font color="#FF0000"># Exits program if a proper extension is not obtained.
</font><font color="#EB5E00">def</font> <font color="#0000FF">extFromCommand</font><font color="#000000">(</font><font color="#000000">args</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">" input must be sys.argv array with python program as first element "</font>
    <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">args</font><font color="#000000">)</font> <font color="#000000">&lt;</font> <font color="#000000">2</font><font color="#000000">:</font>
        <font color="#000000">ext</font> <font color="#000000">=</font> <font color="#000000">raw_input</font><font color="#000000">(</font><font color="#008800">"data extension: "</font><font color="#000000">)</font>
        <font color="#EB5E00">if</font> <font color="#EB5E00">not</font> <font color="#000000">ext</font><font color="#000000">:</font>
            <font color="#EB5E00">return</font> <font color="#008800">""</font>
    <font color="#EB5E00">else</font><font color="#000000">:</font>
        <font color="#000000">ext</font> <font color="#000000">=</font> <font color="#000000">args</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font>

    <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">ext</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">3</font> <font color="#EB5E00">and</font> <font color="#000000">ext</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#000000">!=</font> <font color="#008800">'.'</font><font color="#000000">:</font>
        <font color="#000000">next</font> <font color="#000000">=</font>  <font color="#008800">'.'</font> <font color="#000000">+</font> <font color="#000000">ext</font>
    <font color="#EB5E00">elif</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">ext</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">4</font> <font color="#EB5E00">and</font> <font color="#000000">ext</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#000000">==</font> <font color="#008800">'.'</font><font color="#000000">:</font>
        <font color="#000000">next</font> <font color="#000000">=</font> <font color="#000000">ext</font>
    <font color="#EB5E00">else</font><font color="#000000">:</font>
        <font color="#000000">next</font> <font color="#000000">=</font> <font color="#008800">""</font>

    <font color="#EB5E00">if</font> <font color="#000000">next</font> <font color="#000000">==</font> <font color="#008800">""</font><font color="#000000">:</font>
        <font color="#EB5E00">print</font> <font color="#008800">"extFromCommand: improper file extension. EXITING"</font>
        <font color="#000000">sys</font><font color="#000000">.</font><font color="#000000">exit</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#EB5E00">else</font><font color="#000000">:</font>
        <font color="#EB5E00">return</font> <font color="#000000">next</font>

<font color="#000000">re_section</font> <font color="#000000">=</font> <font color="#000000">re</font><font color="#000000">.</font><font color="#000000">compile</font><font color="#000000">(</font><font color="#008800">'# *--+ *[ \w]+ *--+'</font><font color="#000000">)</font>   <font color="#FF0000"># patterns: "# --- word ---"</font>

<font color="#000000">_end_header</font> <font color="#000000">=</font> <font color="#008800">"END BATCH HEADER"</font>

<font color="#FF0000"># hdrdict[section_heading] = [ [var, value, comment], [var, val, cmt], ... ]
</font><font color="#EB5E00">def</font> <font color="#0000FF">mkHeaderDictionary</font><font color="#000000">(</font><font color="#000000">B</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">"read python batch file header, returns a dictionary"</font>
    <font color="#000000">hdrdict</font> <font color="#000000">=</font> <font color="#000000">{</font><font color="#000000">}</font>
    <font color="#000000">title</font> <font color="#000000">=</font> <font color="#000000">None</font>
    <font color="#EB5E00">for</font> <font color="#000000">line</font> <font color="#EB5E00">in</font> <font color="#000000">B</font><font color="#000000">:</font>
        <font color="#000000">line</font> <font color="#000000">=</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
        <font color="#EB5E00">if</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">upper</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#000000">_end_header</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font><font color="#000000">:</font>
            <font color="#EB5E00">return</font> <font color="#000000">hdrdict</font>
        <font color="#EB5E00">if</font> <font color="#000000">re_section</font><font color="#000000">.</font><font color="#000000">match</font><font color="#000000">(</font><font color="#000000">line</font><font color="#000000">)</font><font color="#000000">:</font>
            <font color="#000000">s</font> <font color="#000000">=</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">replace</font><font color="#000000">(</font><font color="#008800">'#'</font><font color="#000000">,</font><font color="#008800">''</font><font color="#000000">)</font>
            <font color="#000000">title</font> <font color="#000000">=</font> <font color="#000000">s</font><font color="#000000">.</font><font color="#000000">replace</font><font color="#000000">(</font><font color="#008800">'-'</font><font color="#000000">,</font><font color="#008800">''</font><font color="#000000">)</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#000000">hdrdict</font><font color="#000000">[</font><font color="#000000">title</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>
        <font color="#EB5E00">elif</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'='</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font> <font color="#EB5E00">and</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'#'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font> <font color="#EB5E00">and</font> <font color="#000000">line</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#000000">!=</font> <font color="#008800">'#'</font><font color="#000000">:</font>
            <font color="#FF0000"># line has an assignment and a comment
</font>            <font color="#000000">d</font> <font color="#000000">=</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#008800">'='</font><font color="#000000">)</font>
            <font color="#000000">var</font> <font color="#000000">=</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#000000">vc</font> <font color="#000000">=</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#008800">'#'</font><font color="#000000">)</font>
            <font color="#000000">val</font> <font color="#000000">=</font> <font color="#000000">vc</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">vc</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#000000">asgn</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">var</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">]</font>
            <font color="#EB5E00">if</font> <font color="#000000">title</font> <font color="#EB5E00">in</font> <font color="#000000">hdrdict</font><font color="#000000">:</font>
                <font color="#000000">hdrdict</font><font color="#000000">[</font><font color="#000000">title</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">asgn</font><font color="#000000">)</font>
            <font color="#EB5E00">else</font><font color="#000000">:</font>
                <font color="#EB5E00">print</font> <font color="#008800">"Error: line not within a section heading: %s"</font> <font color="#000000">%</font> <font color="#000000">line</font>
    <font color="#EB5E00">return</font> <font color="#000000">hdrdict</font>

<font color="#FF0000"># Adds extension to string variables in the batch file header.
</font><font color="#FF0000"># Makes changes in the namespace of the calling module. Weird, huh?
</font><font color="#EB5E00">def</font> <font color="#0000FF">putExtension</font><font color="#000000">(</font><font color="#000000">ext</font><font color="#000000">,</font> <font color="#000000">force</font><font color="#000000">=</font><font color="#000000">0</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#000000">f</font> <font color="#000000">=</font> <font color="#000000">getouterframes</font><font color="#000000">(</font><font color="#000000">currentframe</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">)</font>
    <font color="#000000">caller</font> <font color="#000000">=</font> <font color="#000000">f</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font>
    <font color="#000000">frameinfo</font> <font color="#000000">=</font> <font color="#000000">getframeinfo</font><font color="#000000">(</font><font color="#000000">caller</font><font color="#000000">)</font>
    <font color="#000000">filename</font> <font color="#000000">=</font> <font color="#000000">frameinfo</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font>
    <font color="#000000">nlines</font> <font color="#000000">=</font> <font color="#000000">frameinfo</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font>
    <font color="#000000">vardict</font> <font color="#000000">=</font> <font color="#000000">caller</font><font color="#000000">.</font><font color="#000000">f_locals</font>
    <font color="#FF0000"># use linecache to retrieve lines up to the call to this function
</font>    <font color="#000000">hdr</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>
    <font color="#EB5E00">for</font> <font color="#000000">i</font> <font color="#EB5E00">in</font> <font color="#000000">range</font><font color="#000000">(</font><font color="#000000">nlines</font><font color="#000000">)</font><font color="#000000">:</font>
        <font color="#000000">hdr</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">getline</font><font color="#000000">(</font><font color="#000000">filename</font><font color="#000000">,</font> <font color="#000000">i</font><font color="#000000">)</font><font color="#000000">)</font>
    <font color="#000000">vkeys</font> <font color="#000000">=</font> <font color="#000000">vardict</font><font color="#000000">.</font><font color="#000000">keys</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#000000">hdrdict</font> <font color="#000000">=</font> <font color="#000000">mkHeaderDictionary</font><font color="#000000">(</font><font color="#000000">hdr</font><font color="#000000">)</font>

    <font color="#FF0000"># Construct a list of variables found in the header.
</font>    <font color="#FF0000"># Skip if 'directory' found in section heading or in comment.
</font>    <font color="#FF0000"># Skip if already has an extension (unless force=1).
</font>    <font color="#000000">hdrvars</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>
    <font color="#000000">sections</font> <font color="#000000">=</font> <font color="#000000">hdrdict</font><font color="#000000">.</font><font color="#000000">keys</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#EB5E00">for</font> <font color="#000000">sect</font> <font color="#EB5E00">in</font> <font color="#000000">sections</font><font color="#000000">:</font>
        <font color="#000000">s</font> <font color="#000000">=</font> <font color="#000000">sect</font><font color="#000000">.</font><font color="#000000">lower</font><font color="#000000">(</font><font color="#000000">)</font>
        <font color="#EB5E00">if</font> <font color="#000000">s</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'directory'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font> <font color="#EB5E00">or</font> <font color="#000000">s</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'directories'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font><font color="#000000">:</font>
            <font color="#FF0000">#print "skipping %s" % sect
</font>            <font color="#EB5E00">continue</font>
        <font color="#000000">lines</font> <font color="#000000">=</font> <font color="#000000">hdrdict</font><font color="#000000">[</font><font color="#000000">sect</font><font color="#000000">]</font>
        <font color="#EB5E00">for</font> <font color="#000000">a</font> <font color="#EB5E00">in</font> <font color="#000000">lines</font><font color="#000000">:</font>
            <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">a</font><font color="#000000">)</font> <font color="#000000">&lt;</font> <font color="#000000">3</font><font color="#000000">:</font>  <font color="#FF0000"># empty section?</font>
                <font color="#EB5E00">continue</font>
            <font color="#000000">var</font> <font color="#000000">=</font> <font color="#000000">a</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font>
            <font color="#000000">val</font> <font color="#000000">=</font> <font color="#000000">a</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font>
            <font color="#000000">com</font> <font color="#000000">=</font> <font color="#000000">a</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font>
            <font color="#EB5E00">if</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#000000">val</font><font color="#000000">)</font> <font color="#000000">!=</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#008800">"string"</font><font color="#000000">)</font><font color="#000000">:</font>
                <font color="#FF0000">#print "skipping %s" % val
</font>                <font color="#EB5E00">continue</font>
            <font color="#EB5E00">elif</font> <font color="#EB5E00">not</font> <font color="#000000">force</font><font color="#000000">:</font>
                <font color="#FF0000"># if it is a string, see if it has an extension
</font>                <font color="#000000">name</font><font color="#000000">,</font> <font color="#000000">ext2</font> <font color="#000000">=</font> <font color="#000000">os</font><font color="#000000">.</font><font color="#000000">path</font><font color="#000000">.</font><font color="#000000">splitext</font><font color="#000000">(</font><font color="#000000">val</font><font color="#000000">)</font>
                <font color="#EB5E00">if</font> <font color="#000000">ext2</font><font color="#000000">:</font>
                    <font color="#FF0000">#print  "skipping %s" % val
</font>                    <font color="#EB5E00">continue</font>
            <font color="#EB5E00">if</font> <font color="#000000">com</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'directory'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font> <font color="#EB5E00">or</font> <font color="#000000">com</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'directories'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font><font color="#000000">:</font>
                <font color="#FF0000">#print "skipping %s" % var
</font>                <font color="#EB5E00">continue</font>
            <font color="#000000">hdrvars</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">var</font><font color="#000000">)</font>

    <font color="#FF0000">#print hdrvars
</font>    <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">hdrvars</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">0</font><font color="#000000">:</font>
        <font color="#EB5E00">return</font>
    <font color="#FF0000"># change the values of the variables in vardict from calling frame
</font>    <font color="#EB5E00">for</font> <font color="#000000">hv</font> <font color="#EB5E00">in</font> <font color="#000000">hdrvars</font><font color="#000000">:</font>
        <font color="#EB5E00">if</font> <font color="#000000">hv</font> <font color="#EB5E00">in</font> <font color="#000000">vkeys</font><font color="#000000">:</font>
            <font color="#000000">val</font> <font color="#000000">=</font> <font color="#000000">vardict</font><font color="#000000">[</font><font color="#000000">hv</font><font color="#000000">]</font>
            <font color="#FF0000">#print "%s: %s" % (str(hv), str(val))
</font>            <font color="#EB5E00">if</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#000000">val</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#008800">"string"</font><font color="#000000">)</font><font color="#000000">:</font>
                <font color="#000000">newval</font> <font color="#000000">=</font> <font color="#000000">val</font> <font color="#000000">+</font> <font color="#000000">ext</font>
                <font color="#000000">vardict</font><font color="#000000">[</font><font color="#000000">hv</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">newval</font>

<font color="#EB5E00">def</font> <font color="#0000FF">useFilenums</font><font color="#000000">(</font><font color="#000000">filenums</font><font color="#000000">,</font> <font color="#000000">template</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">"returns filename list, with filenums substituted into template asterisks"</font>
    <font color="#008800">" filenums: list of filenumbers   "</font>
    <font color="#008800">" template: e.g., img****.dat, SPIDER filename template w/ asterisks "</font>
    <font color="#000000">files</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>
    <font color="#EB5E00">if</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#000000">filenums</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">type</font><font color="#000000">(</font><font color="#008800">"string"</font><font color="#000000">)</font><font color="#000000">:</font>
        <font color="#EB5E00">if</font> <font color="#000000">os</font><font color="#000000">.</font><font color="#000000">path</font><font color="#000000">.</font><font color="#000000">exists</font><font color="#000000">(</font><font color="#000000">filenums</font><font color="#000000">)</font><font color="#000000">:</font>
            <font color="#000000">filenums</font> <font color="#000000">=</font> <font color="#000000">readdoc</font><font color="#000000">(</font><font color="#000000">filenums</font><font color="#000000">)</font>
    <font color="#EB5E00">for</font> <font color="#000000">i</font> <font color="#EB5E00">in</font> <font color="#000000">filenums</font><font color="#000000">:</font>
        <font color="#000000">files</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">makeSpiderFilename</font><font color="#000000">(</font><font color="#000000">template</font><font color="#000000">,</font> <font color="#000000">i</font><font color="#000000">)</font><font color="#000000">)</font>
    <font color="#EB5E00">return</font> <font color="#000000">files</font>


<font color="#FF0000"># ######################################################################
</font><font color="#FF0000"># Parameter doc file utilities:
</font><font color="#FF0000">#      getParameters(parmfile)  a function that returns a dictionary.
</font><font color="#FF0000">#      P = Parameters(parmfile)  a class that returns an object.
</font>
<font color="#FF0000"># ---------------------------------------------------------------------
</font><font color="#FF0000">#
</font><font color="#FF0000"># getParameters: reads a parameter doc file (1 data column) and returns a
</font><font color="#FF0000">#                parameter dictionary, indexed by keys (integers).
</font><font color="#FF0000"># Each entry is a list with 2,3, or 4 elements, depending on what it finds:
</font><font color="#FF0000"># P[1] = [1, 0.0]                   # no comment was found
</font><font color="#FF0000"># P[1] = [1, 0.0, 'zip flag']       # comment found
</font><font color="#FF0000"># P[1] = [1, 0.0, 'zip flag', ['do not unzip', 'unzip']]  # comment has list
</font><font color="#EB5E00">def</font> <font color="#0000FF">getParameters</font><font color="#000000">(</font><font color="#000000">parmfile</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">" returns parameter dictionary, or None "</font>
    <font color="#000000">B</font> <font color="#000000">=</font> <font color="#000000">fileReadLines</font><font color="#000000">(</font><font color="#000000">parmfile</font><font color="#000000">)</font>
    <font color="#000000">nlines</font> <font color="#000000">=</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">B</font><font color="#000000">)</font>
    <font color="#000000">PD</font> <font color="#000000">=</font> <font color="#000000">{</font><font color="#000000">}</font>
    <font color="#000000">ptr</font> <font color="#000000">=</font> <font color="#000000">0</font>

    <font color="#EB5E00">while</font> <font color="#000000">ptr</font> <font color="#000000">&lt;</font> <font color="#000000">nlines</font><font color="#000000">:</font>
        <font color="#000000">line</font> <font color="#000000">=</font> <font color="#000000">B</font><font color="#000000">[</font><font color="#000000">ptr</font><font color="#000000">]</font>
        <font color="#EB5E00">if</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#008800">""</font><font color="#000000">:</font>
            <font color="#000000">ptr</font> <font color="#000000">+=</font> <font color="#000000">1</font>
            <font color="#EB5E00">continue</font>

        <font color="#EB5E00">if</font> <font color="#000000">isParmDataLine</font><font color="#000000">(</font><font color="#000000">line</font><font color="#000000">)</font><font color="#000000">:</font>
            <font color="#000000">d</font> <font color="#000000">=</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#000000">key</font> <font color="#000000">=</font> <font color="#000000">int</font><font color="#000000">(</font><font color="#000000">float</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">)</font>
            <font color="#000000">val</font> <font color="#000000">=</font> <font color="#000000">float</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#000000">)</font>
            <font color="#FF0000"># is comment on the same line?
</font>            <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">3</font><font color="#000000">:</font>
                <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#008800">""</font>
                <font color="#EB5E00">for</font> <font color="#000000">item</font> <font color="#EB5E00">in</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">:</font><font color="#000000">]</font><font color="#000000">:</font>
                    <font color="#000000">comment</font> <font color="#000000">+=</font> <font color="#000000">item</font> <font color="#000000">+</font> <font color="#008800">" "</font>
                <font color="#EB5E00">if</font> <font color="#000000">comment</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#000000">==</font> <font color="#008800">';'</font><font color="#000000">:</font>
                    <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">comment</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">:</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
                <font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">clist</font> <font color="#000000">=</font> <font color="#000000">findBrackets</font><font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">)</font>
                <font color="#EB5E00">if</font> <font color="#000000">clist</font> <font color="#000000">==</font> <font color="#000000">None</font><font color="#000000">:</font>
                    <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">key</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">]</font>
                <font color="#EB5E00">else</font><font color="#000000">:</font>
                    <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">key</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">clist</font><font color="#000000">]</font>
            <font color="#EB5E00">else</font><font color="#000000">:</font>
                <font color="#FF0000"># is comment on previous line?
</font>                <font color="#EB5E00">if</font> <font color="#000000">ptr</font> <font color="#000000">!=</font> <font color="#000000">0</font><font color="#000000">:</font>
                    <font color="#000000">pline</font> <font color="#000000">=</font> <font color="#000000">B</font><font color="#000000">[</font><font color="#000000">ptr</font><font color="#000000">-</font><font color="#000000">1</font><font color="#000000">]</font>
                    <font color="#EB5E00">if</font> <font color="#000000">pline</font><font color="#000000">[</font><font color="#000000">:</font><font color="#000000">4</font><font color="#000000">]</font> <font color="#000000">==</font> <font color="#008800">' ; /'</font><font color="#000000">:</font>
                        <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">pline</font><font color="#000000">[</font><font color="#000000">4</font><font color="#000000">:</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
                        <font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">clist</font> <font color="#000000">=</font> <font color="#000000">findBrackets</font><font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">)</font>
                        <font color="#EB5E00">if</font> <font color="#000000">clist</font> <font color="#000000">==</font> <font color="#000000">None</font><font color="#000000">:</font>
                            <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">key</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">]</font>
                        <font color="#EB5E00">else</font><font color="#000000">:</font>
                            <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">key</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">clist</font><font color="#000000">]</font>
                    <font color="#EB5E00">else</font><font color="#000000">:</font>
                        <font color="#FF0000"># comment not found
</font>                        <font color="#EB5E00">print</font> <font color="#008800">"WARNING: getParameters: no comment found. "</font> \
                              <font color="#008800">"Is %s a valid parameter file?"</font> <font color="#000000">%</font> <font color="#000000">parmfile</font>
                        <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">key</font><font color="#000000">,</font> <font color="#000000">val</font><font color="#000000">]</font>
        <font color="#000000">ptr</font> <font color="#000000">+=</font> <font color="#000000">1</font>

    <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">PD</font><font color="#000000">)</font> <font color="#000000">==</font> <font color="#000000">0</font><font color="#000000">:</font> <font color="#EB5E00">return</font> <font color="#000000">None</font>
    <font color="#EB5E00">else</font><font color="#000000">:</font> <font color="#EB5E00">return</font> <font color="#000000">PD</font>

<font color="#EB5E00">def</font> <font color="#0000FF">isParmDataLine</font><font color="#000000">(</font><font color="#000000">line</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">"line must be of the form: 'key 1 value' (i.e., int 1 float)"</font>
    <font color="#000000">d</font> <font color="#000000">=</font> <font color="#000000">line</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">)</font> <font color="#000000">&lt;</font> <font color="#000000">3</font><font color="#000000">:</font>
        <font color="#EB5E00">return</font> <font color="#000000">0</font>
    <font color="#EB5E00">try</font><font color="#000000">:</font>
        <font color="#000000">key</font> <font color="#000000">=</font> <font color="#000000">int</font><font color="#000000">(</font><font color="#000000">float</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">)</font>
        <font color="#000000">num</font> <font color="#000000">=</font> <font color="#000000">int</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">)</font>
        <font color="#EB5E00">if</font> <font color="#000000">num</font> <font color="#000000">!=</font> <font color="#000000">1</font><font color="#000000">:</font>
            <font color="#EB5E00">return</font> <font color="#000000">0</font>
        <font color="#000000">val</font> <font color="#000000">=</font> <font color="#000000">float</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#000000">)</font>
        <font color="#EB5E00">return</font> <font color="#000000">1</font>
    <font color="#EB5E00">except</font><font color="#000000">:</font>
        <font color="#EB5E00">return</font> <font color="#000000">0</font>

<font color="#EB5E00">def</font> <font color="#0000FF">findBrackets</font><font color="#000000">(</font><font color="#000000">s</font><font color="#000000">)</font><font color="#000000">:</font>
    <font color="#008800">" given a comment with brackets : zip flag ['do not unzip', ' unzip'] "</font>
    <font color="#008800">" returns (comment, list)   or (comment, None) if no brackets "</font>
    <font color="#000000">s</font> <font color="#000000">=</font> <font color="#000000">s</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#FF0000"># look for end bracket
</font>    <font color="#EB5E00">if</font> <font color="#000000">s</font><font color="#000000">[</font><font color="#000000">-</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#000000">!=</font> <font color="#008800">']'</font><font color="#000000">:</font> <font color="#EB5E00">return</font> <font color="#000000">(</font><font color="#000000">s</font><font color="#000000">,</font> <font color="#000000">None</font><font color="#000000">)</font>
    <font color="#000000">lb</font> <font color="#000000">=</font> <font color="#000000">s</font><font color="#000000">.</font><font color="#000000">rfind</font><font color="#000000">(</font><font color="#008800">'['</font><font color="#000000">)</font>
    <font color="#EB5E00">if</font> <font color="#000000">lb</font> <font color="#000000">&lt;</font> <font color="#000000">0</font><font color="#000000">:</font> <font color="#EB5E00">return</font> <font color="#000000">(</font><font color="#000000">s</font><font color="#000000">,</font> <font color="#000000">None</font><font color="#000000">)</font>

    <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">s</font><font color="#000000">[</font><font color="#000000">:</font><font color="#000000">lb</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>
    <font color="#000000">dlist</font> <font color="#000000">=</font> <font color="#000000">s</font><font color="#000000">[</font><font color="#000000">lb</font><font color="#000000">:</font><font color="#000000">]</font>

    <font color="#FF0000"># dlist must have at least 2 items separated by comma
</font>    <font color="#EB5E00">if</font> <font color="#000000">dlist</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">','</font><font color="#000000">)</font> <font color="#000000">&lt;</font> <font color="#000000">-</font><font color="#000000">1</font><font color="#000000">:</font> <font color="#EB5E00">return</font> <font color="#000000">(</font><font color="#000000">s</font><font color="#000000">,</font> <font color="#000000">None</font><font color="#000000">)</font>
    <font color="#000000">choices</font> <font color="#000000">=</font> <font color="#000000">None</font>

    <font color="#FF0000"># string "['thing1', 'thing2']" must be converted to python list.
</font>    <font color="#FF0000"># If they're already quoted, just eval the string
</font>    <font color="#EB5E00">try</font><font color="#000000">:</font>
        <font color="#000000">choices</font> <font color="#000000">=</font> <font color="#000000">eval</font><font color="#000000">(</font><font color="#000000">dlist</font><font color="#000000">)</font>
    <font color="#EB5E00">except</font><font color="#000000">:</font>
        <font color="#FF0000"># no quotes? convert to list
</font>        <font color="#000000">dlist</font> <font color="#000000">=</font> <font color="#000000">dlist</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">:</font><font color="#000000">-</font><font color="#000000">1</font><font color="#000000">]</font>  <font color="#FF0000"># remove brackets</font>
        <font color="#000000">d</font> <font color="#000000">=</font> <font color="#000000">dlist</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#008800">','</font><font color="#000000">)</font>
        <font color="#000000">choices</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>
        <font color="#EB5E00">for</font> <font color="#000000">item</font> <font color="#EB5E00">in</font> <font color="#000000">d</font><font color="#000000">:</font>
            <font color="#000000">choices</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">item</font><font color="#000000">)</font>

    <font color="#EB5E00">if</font> <font color="#000000">comment</font><font color="#000000">[</font><font color="#000000">-</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#000000">==</font> <font color="#008800">','</font><font color="#000000">:</font>
        <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">comment</font><font color="#000000">[</font><font color="#000000">:</font><font color="#000000">-</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">strip</font><font color="#000000">(</font><font color="#000000">)</font>

    <font color="#EB5E00">return</font> <font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">choices</font><font color="#000000">)</font>

<font color="#FF0000"># ##################################################################
</font><font color="#FF0000"># A class for the Spider parameters doc file
</font><font color="#FF0000"># NB, use 'wavelength' instead of 'lambda' since the
</font><font color="#FF0000">#     latter is a reserved word in Python.
</font><font color="#FF0000">#
</font><font color="#FF0000"># Usage: P = Parameters('../params.hcc')
</font><font color="#FF0000"># then to access, use P.key
</font><font color="#FF0000"># &gt;&gt;&gt; P.kv
</font><font color="#FF0000"># 300.0
</font>
<font color="#EB5E00">class</font> <font color="#000000">Parameters</font><font color="#000000">:</font>
    <font color="#EB5E00">def</font> <font color="#0000FF">__init__</font><font color="#000000">(</font><font color="#000000">self</font><font color="#000000">,</font> <font color="#000000">docfile</font><font color="#000000">,</font> <font color="#000000">usecomments</font><font color="#000000">=</font><font color="#000000">0</font><font color="#000000">)</font><font color="#000000">:</font>
        <font color="#000000">PD</font> <font color="#000000">=</font> <font color="#000000">getParameters</font><font color="#000000">(</font><font color="#000000">docfile</font><font color="#000000">)</font>
        <font color="#EB5E00">if</font> <font color="#000000">PD</font> <font color="#000000">==</font> <font color="#000000">None</font><font color="#000000">:</font> <font color="#EB5E00">return</font>

        <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">D</font> <font color="#000000">=</font> <font color="#000000">{</font><font color="#000000">}</font>
        <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">attribs</font> <font color="#000000">=</font> <font color="#000000">[</font><font color="#000000">]</font>  <font color="#FF0000"># list of attributes</font>

        <font color="#EB5E00">if</font> <font color="#EB5E00">not</font> <font color="#000000">usecomments</font><font color="#000000">:</font>
            <font color="#FF0000"># standard Spider single particle reconstruction parameter file
</font>            <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">K</font> <font color="#000000">=</font> <font color="#000000">{</font><font color="#000000">1</font><font color="#000000">:</font><font color="#008800">'zip'</font><font color="#000000">,</font>
                      <font color="#000000">2</font><font color="#000000">:</font><font color="#008800">'scan_format'</font><font color="#000000">,</font>
                      <font color="#000000">3</font><font color="#000000">:</font><font color="#008800">'width'</font><font color="#000000">,</font>
                      <font color="#000000">4</font><font color="#000000">:</font><font color="#008800">'height'</font><font color="#000000">,</font>
                      <font color="#000000">5</font><font color="#000000">:</font> <font color="#008800">"pixel_size"</font><font color="#000000">,</font>
                      <font color="#000000">6</font><font color="#000000">:</font> <font color="#008800">'kv'</font><font color="#000000">,</font>
                      <font color="#000000">7</font><font color="#000000">:</font> <font color="#008800">'Cs'</font><font color="#000000">,</font>
                      <font color="#000000">8</font><font color="#000000">:</font> <font color="#008800">'source_size'</font><font color="#000000">,</font>
                      <font color="#000000">9</font> <font color="#000000">:</font> <font color="#008800">'defocus_spread'</font><font color="#000000">,</font>
                      <font color="#000000">10</font><font color="#000000">:</font> <font color="#008800">'astigmatism'</font><font color="#000000">,</font>
                      <font color="#000000">11</font><font color="#000000">:</font> <font color="#008800">'azimuth'</font><font color="#000000">,</font>
                      <font color="#000000">12</font><font color="#000000">:</font> <font color="#008800">'acr'</font><font color="#000000">,</font>
                      <font color="#000000">13</font><font color="#000000">:</font> <font color="#008800">'Gaussian_env'</font><font color="#000000">,</font>
                      <font color="#000000">14</font><font color="#000000">:</font> <font color="#008800">'wavelength'</font><font color="#000000">,</font>  <font color="#FF0000">#'Lambda',</font>
                      <font color="#000000">15</font><font color="#000000">:</font> <font color="#008800">'max_spat_freq'</font><font color="#000000">,</font>
                      <font color="#000000">16</font><font color="#000000">:</font> <font color="#008800">'decimation'</font><font color="#000000">,</font>
                      <font color="#000000">17</font><font color="#000000">:</font> <font color="#008800">'window_size'</font><font color="#000000">,</font>
                      <font color="#000000">18</font><font color="#000000">:</font> <font color="#008800">'particle_size'</font><font color="#000000">,</font>
                      <font color="#000000">19</font><font color="#000000">:</font> <font color="#008800">'magnification'</font><font color="#000000">,</font>
                      <font color="#000000">20</font><font color="#000000">:</font> <font color="#008800">'scanning_res'</font><font color="#000000">}</font>

            <font color="#000000">keys</font> <font color="#000000">=</font> <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">K</font><font color="#000000">.</font><font color="#000000">keys</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#EB5E00">for</font> <font color="#000000">key</font> <font color="#EB5E00">in</font> <font color="#000000">keys</font><font color="#000000">:</font>
                <font color="#EB5E00">if</font> <font color="#000000">key</font> <font color="#EB5E00">in</font> <font color="#000000">PD</font><font color="#000000">:</font>
                    <font color="#000000">value</font> <font color="#000000">=</font> <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font>
                    <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">D</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">value</font>
                    <font color="#000000">estr</font> <font color="#000000">=</font> <font color="#008800">"self.%s = %f"</font> <font color="#000000">%</font> <font color="#000000">(</font><font color="#000000">self</font><font color="#000000">.</font><font color="#000000">K</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font><font color="#000000">,</font> <font color="#000000">value</font><font color="#000000">)</font>
                    <font color="#EB5E00">exec</font><font color="#000000">(</font><font color="#000000">estr</font><font color="#000000">)</font>
                    <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">attribs</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">self</font><font color="#000000">.</font><font color="#000000">K</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font><font color="#000000">)</font>

        <font color="#EB5E00">elif</font> <font color="#000000">usecomments</font><font color="#000000">:</font>
            <font color="#FF0000"># use the comment as the attribute. USES FIRST WORD IN COMMENT
</font>            <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">K</font> <font color="#000000">=</font> <font color="#000000">{</font><font color="#000000">}</font>
            <font color="#000000">keys</font> <font color="#000000">=</font> <font color="#000000">PD</font><font color="#000000">.</font><font color="#000000">keys</font><font color="#000000">(</font><font color="#000000">)</font>
            <font color="#EB5E00">for</font> <font color="#000000">key</font> <font color="#EB5E00">in</font> <font color="#000000">keys</font><font color="#000000">:</font>
                <font color="#000000">d</font> <font color="#000000">=</font> <font color="#000000">PD</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font>
                <font color="#EB5E00">if</font> <font color="#000000">len</font><font color="#000000">(</font><font color="#000000">d</font><font color="#000000">)</font> <font color="#000000">&lt;</font> <font color="#000000">3</font><font color="#000000">:</font>
                    <font color="#EB5E00">print</font> <font color="#008800">"ERROR: key %d has no associated comment"</font>
                    <font color="#EB5E00">continue</font>
                <font color="#000000">value</font> <font color="#000000">=</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font>
                <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">D</font><font color="#000000">[</font><font color="#000000">key</font><font color="#000000">]</font> <font color="#000000">=</font> <font color="#000000">value</font>
                <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#000000">.</font><font color="#000000">split</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font>  <font color="#FF0000"># get the first word</font>
                <font color="#EB5E00">if</font> <font color="#000000">comment</font> <font color="#000000">==</font> <font color="#008800">""</font><font color="#000000">:</font>
                    <font color="#EB5E00">print</font> <font color="#008800">"ERROR: key %d has no associated comment"</font>
                    <font color="#EB5E00">continue</font>
                <font color="#EB5E00">if</font> <font color="#000000">hasattr</font><font color="#000000">(</font><font color="#000000">self</font><font color="#000000">,</font> <font color="#000000">comment</font><font color="#000000">)</font><font color="#000000">:</font>
                    <font color="#EB5E00">print</font> <font color="#008800">"ERROR: comment for key %d already in use"</font> <font color="#000000">%</font> <font color="#000000">key</font>
                    <font color="#EB5E00">continue</font>
                <font color="#EB5E00">if</font> <font color="#000000">comment</font> <font color="#000000">==</font> <font color="#008800">'lambda'</font><font color="#000000">:</font>
                    <font color="#EB5E00">print</font> <font color="#008800">"RESERVED WORD WARNING: using 'wavelength' instead of 'lambda'"</font>
                    <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#008800">'wavelength'</font>
                <font color="#EB5E00">if</font> <font color="#000000">comment</font><font color="#000000">.</font><font color="#000000">find</font><font color="#000000">(</font><font color="#008800">'.'</font><font color="#000000">)</font> <font color="#000000">&gt;</font> <font color="#000000">-</font><font color="#000000">1</font><font color="#000000">:</font>
                    <font color="#000000">comment</font> <font color="#000000">=</font> <font color="#000000">comment</font><font color="#000000">.</font><font color="#000000">replace</font><font color="#000000">(</font><font color="#008800">'.'</font><font color="#000000">,</font><font color="#008800">'_'</font><font color="#000000">)</font>

                <font color="#000000">estr</font> <font color="#000000">=</font> <font color="#008800">"self.%s = %f"</font> <font color="#000000">%</font> <font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">value</font><font color="#000000">)</font>
                <font color="#EB5E00">try</font><font color="#000000">:</font>
                    <font color="#EB5E00">exec</font><font color="#000000">(</font><font color="#000000">estr</font><font color="#000000">)</font>
                    <font color="#000000">self</font><font color="#000000">.</font><font color="#000000">attribs</font><font color="#000000">.</font><font color="#000000">append</font><font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">)</font>
                <font color="#EB5E00">except</font><font color="#000000">:</font>
                    <font color="#EB5E00">print</font> <font color="#008800">"ERROR: unable to evaluate %s from %s"</font> <font color="#000000">%</font> <font color="#000000">(</font><font color="#000000">comment</font><font color="#000000">,</font> <font color="#000000">d</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000"></font></font></pre></body></html>
