<html>
<head>
   <title>ctfgroup.py</title>
   <link rel='stylesheet' href='spidertools.css' type='text/css' />
</head>

<body>
	
<h2>Assign micrographs to defocus groups - ctfgroup.py - </h2>

<p> Usage: <b><code>ctfgroup.py [-s] def_sort.dat</code></b></p>

<p>The optional -s flag uses small fonts in the display.</p>

<p>
  <a href="#Overview">Overview</a>                <br />
  <a href="#Inputs">Input files</a>               <br />
  <a href="#Grouping">Selecting defocus groups</a><br />
  <a href="#Plotting">Plotting power spectra</a>  <br />
  <a href="#Saving">Saving your selections</a>    <br />
  <a href="#defspread">Defocus spread</a>         <br />
</p>

<p><a name="Overview">
<ul>
  <li> In the main window, <font class="prog">ctfgroup.py</font> displays a point for each 
       micrograph, sorted by defocus.</li>

  <li> You can put points/micrographs into defocus groups by outlining them with the 
       <i>left mouse button</i>.</li>

  <li> The power spectra of color-coded defocus groups can be viewed in Gnuplot with the 
       <i>right mouse button</i>.</li>
</ul>
</p> 

<p>
The objective is to assign all micrographs to a set of defocus groups using two constraints:       <br />
1) Maximize the number of micrographs in each group. SNR increases with the number of particles.   <br />
2) Keep defocus values within each group as small as possible (minimize defocus spread). 
   Power spectra of micrographs from the same defocus group should be plotted together, to ensure
    that their zeroes (minima) line up, and do not cancel out. 
</p>

<p>
<table>
  <tr>
    <td rowspan="2"><img src="pics/defgrp001.gif"></td>
    <td><img src="pics/defgrp002.gif"></td>
  </tr>
  <tr>
    <td><img src="pics/defgrp003.gif"></td>
  </tr>
</table>
</p> 

<p><a name="Inputs">
<b>Inputs</b>

<ul>
   <li> <font class="prog">ctfgroup.py</font> reads a SPIDER document file with Micrograph 
        numbers and their corresponding defocus values in the 1st and 2nd data columns, 
        respectively. An example is the file <code class="output">def_sort.ext</code> 
        created by the procedure <a href="../../docs/techs/recon/newprogs/defsort.spi">defsort.spi</a>, 
        during <a href="../../docs/techs/recon/mr.html#CTF">single particle reconstruction</a>. 
        If there is a third column with defocus group numbers, <font class="prog">ctfgroup.py</font> 
        will use these numbers to color the data points. This doc file should be named on the 
        command line: <pre>ctfgroup.py def_sort.dat</pre>
   </li>

   <li> To display power spectra, <font class="prog">ctfgroup.py</font> also reads document 
        files specified in the <i>plot files:</i> box in the lower right corner of the 
        main window. The default files for plotting are the 
        <code class="output">power/ctf***.ext</code> files created by the procedure 
        <a href="../../docs/techs/recon/newprogs/defocus.spi">defsort.spi</a>. These files 
        are displayed in Gnuplot with the <a href="./pyplot.html">pyplot</a> interface.
   </li>
</ul>
</p>

<a name="Grouping">
<p><b>Assigning micrographs to defocus groups</b></p>

<p>A defocus group should contain a set of points that are vertically aligned, as far as 
   that is possible. That is, they should have nearly the same defocus. Group points by 
   dragging the left mouse button to outline a box around them. Selected points will be 
   assigned a new color. You may reselect points as often as you wish.
</p>

<a name="Plotting">
<p><b>Plotting power spectra</b></p>

<p>Once points are colored (assigned), their corresponding power spectra doc files can be 
   plotted, by clicking the right mouse button over a group. This opens a Gnuplot window 
   and a <a href="./pyplot.html">pyplot</a> control window. <font class="prog">pyplot</font> 
   reads the file template in the lower left corner of the main window (next to the 
   <b>plot files:</b> button). By default, columns 1 vs 5 are plotted from the 
   <code class="output">power/ctf***</code> doc files. You can enter a different doc file 
   template in the entry box. You can change which columns are plotted in the pyplot 
   control window. The current set of micrographs being plotted are displayed as plus 
   signs in the main <font class="prog">ctfgroup</font> window.
</p>

<a name="Saving">
<p><b>Saving your selections</b></p>

<p><font class="prog">ctfgroup.py</font> lets you save your selections in a doc file with 
   the same data columns as the <code class="output">def_sort</code> file: 
   <code>Micrographs, Defocus, Defocus_Groups</code>. Under the <i>File</i> menu, select 
   <i>Save as</i>, and specify a file name.
</p>

<a name="defspread">
<p><b>Defocus spread</b></p>

<p>Enabling the <i>defocus spread</i> plot (under the <i>File</i> menu) displays the 
envelope computed by setting            <br />
<b><code>defocus spread = max(defocus) - min(defocus)</code></b> within a group. 
The X axis for this plot is spatial frequency.
</p>

<p><a href="index.html">Back to index</a></p>

</body>
</html>
	
