; Rotate and shift the images according to orientation parameters from AP SH

; ----- input -----

FR G
[aligndoc]alignparms    ; doc file of alignment parameters, 

FR G
[data]../Testdata/data/img{****[i]}   ; original image data

; ----- output -----
FR G
[outdir]ali
FR G
[aligned][outdir]/ali{****[i]}    ; aligned image 

; ----------- END BATCH HEADER -------------------
VM
mkdir -p [outdir]

UD N,[n]
[aligndoc]

DO LB1 [i] = 1,[n]

   ; read the alignment parameters from the doc file
   UD [i], x11,x12,x13,x14,x15,[angle],[xshift],[yshift]
   [aligndoc]

   ; RT SQ combines rotation and shifts, reducing interpolation error

   RT SQ      ; rotate and shift
   [data]     ; input
   [aligned]  ; output
   [angle]
   [xshift],[yshift]

LB1

EN D
